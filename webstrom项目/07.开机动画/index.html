<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>主体逻辑</title>
    <link rel="stylesheet" href="./css/index.css">
</head>
<body>
<!--整体最外层-->
<div class="wrap">
    <div class="mask">
        <div class="maskUp"></div>
        <span class="maskLine"></span>
        <div class="maskDown"></div>
    </div>
    <header id="header">
        <div class="logoOuter">
            <h1 class="logo">
                <a href="###"><img src="./img/logo.png" alt=""></a>
            </h1>
            <div class="music">
                <audio src="./img/audio.mp3"></audio>
            </div>
        </div>
        <nav class="nav">
            <ul class="navList">
                <li class="navItem">
                    <a href="###">
                        <p class="up"></p>
                        <p class="down"></p>
                    </a>
                </li>
                <li class="navItem">
                    <a href="###">
                        <p class="up">course</p>
                        <p class="down">course</p>
                    </a>
                </li>
                <li class="navItem">
                    <a href="###">
                        <p class="up">workers</p>
                        <p class="down">workers</p>
                    </a>
                </li>
                <li class="navItem">
                    <a href="###">
                        <p class="up">about</p>
                        <p class="down">about</p>
                    </a>
                </li>
                <li class="navItem">
                    <a href="###">
                        <p class="up">team</p>
                        <p class="down">team</p>
                    </a>
                </li>
            </ul>
        </nav>
        <div class="arrow"></div>
    </header>

    <!--主题 内容-->
    <article class="content">
        <ul class="contentList">
            <!--第一屏-->
            <li class="contentItem">
                <div class="contentInner">
                    <ul class="homeList">
                        <li class="homeItem active"></li>
                        <li class="homeItem"></li>
                        <li class="homeItem"></li>
                        <li class="homeItem"></li>
                    </ul>
                    <ul class="homeNav">
                        <li class="homeIcon active"></li>
                        <li class="homeIcon"></li>
                        <li class="homeIcon"></li>
                        <li class="homeIcon"></li>
                    </ul>
                </div>
            </li>
            <!--第二屏-->
            <li class="contentItem">
                <div class="contentInner">
                    <div class="course1">
                        <p class="course1Tit">EINBLICK</p>
                        <p class="course1Tit">ERKENNTNIS</p>
                        <p class="course1Tit">ERGEBNIS</p>
                    </div>
                    <div class="course2">
                        <p class="course2Text">Das Kundenvertrauen in unsere Kompetenz ist die notwendige Basis einer erfolgreichen Zusammenarbeit, gleichzeitig aber auch das größte Lob, das man uns entgegenbringen kann.</p>
                        <p class="course2Text">Diese und viele weitere große und kleine Kunden vertrauen uns seit Jahren, was uns stolz macht, und dafür sagen wir an dieser Stelle einfach mal.</p>
                    </div>
                    <div class="course3">
                        <div class="plus"></div>
                        <div class="plus"></div>
                        <div class="plus"></div>
                        <div class="plus"></div>
                        <div class="plus"></div>
                        <div class="courseItem">
                            <div class="courseItemInner">
                                <div class="front"></div>
                                <div class="back">看我</div>
                            </div>
                        </div>
                        <div class="courseItem">
                            <div class="courseItemInner">
                                <div class="front"></div>
                                <div class="back">看我</div>
                            </div>
                        </div>
                        <div class="courseItem">
                            <div class="courseItemInner">
                                <div class="front"></div>
                                <div class="back">看我</div>
                            </div>
                        </div>
                        <div class="courseItem">
                            <div class="courseItemInner">
                                <div class="front"></div>
                                <div class="back">看我</div>
                            </div>
                        </div>
                        <div class="courseItem">
                            <div class="courseItemInner">
                                <div class="front"></div>
                                <div class="back">看我</div>
                            </div>
                        </div>
                        <div class="courseItem">
                            <div class="courseItemInner">
                                <div class="front"></div>
                                <div class="back">看我</div>
                            </div>
                        </div>
                        <div class="courseItem">
                            <div class="courseItemInner">
                                <div class="front"></div>
                                <div class="back">看我</div>
                            </div>
                        </div>
                        <div class="courseItem">
                            <div class="courseItemInner">
                                <div class="front"></div>
                                <div class="back">看我</div>
                            </div>
                        </div>
                        <div class="courseItem">
                            <div class="courseItemInner">
                                <div class="front"></div>
                                <div class="back">看我</div>
                            </div>
                        </div>
                        <div class="courseItem">
                            <div class="courseItemInner">
                                <div class="front"></div>
                                <div class="back">看我</div>
                            </div>
                        </div>
                        <div class="courseItem">
                            <div class="courseItemInner">
                                <div class="front"></div>
                                <div class="back">看我</div>
                            </div>
                        </div>
                        <div class="courseItem">
                            <div class="courseItemInner">
                                <div class="front"></div>
                                <div class="back">看我</div>
                            </div>
                        </div>
                    </div>
                    <div class="plane1"></div>
                    <div class="plane2"></div>
                    <div class="plane3"></div>
                </div>
            </li>
            <!--第三屏-->
            <li class="contentItem">
                <div class="contentInner">
                    <div class="worker1">
                        <p class="workerTit">EINBLICK</p>
                        <p class="workerTit">ERKENNTNIS</p>
                        <p class="workerTit">ERGEBNIS</p>
                    </div>
                    <ul class="worker2 clearFix">
                        <li class="workerItem">
                            <img src="./img/worksimg1.jpg" alt="">
                            <div class="mask">
                                <p>爱马仕·巴黎世家·卡地亚</p>
                                <i class="icon"></i>
                            </div>
                        </li>
                        <li class="workerItem">
                            <img src="./img/worksimg2.jpg" alt="">
                            <div class="mask">
                                <p>爱马仕·巴黎世家·卡地亚</p>
                                <i class="icon"></i>
                            </div>
                        </li>
                        <li class="workerItem">
                            <img src="./img/worksimg3.jpg" alt="">
                            <div class="mask">
                                <p>爱马仕·巴黎世家·卡地亚</p>
                                <i class="icon"></i>
                            </div>
                        </li>
                        <li class="workerItem">
                            <img src="./img/worksimg4.jpg" alt="">
                            <div class="mask">
                                <p>爱马仕·巴黎世家·卡地亚</p>
                                <i class="icon"></i>
                            </div>
                        </li>
                    </ul>
                    <div class="worker3"></div>
                    <div class="pancel1"></div>
                    <div class="pancel2"></div>
                    <div class="pancel3"></div>
                </div>
            </li>
            <!--第四屏-->
            <li class="contentItem">
                <div class="contentInner">
                    <div class="about1">
                        <p class="about1Tit">EINBLICK</p>
                        <p class="about1Tit">ERKENNTNIS</p>
                        <p class="about1Tit">ERGEBNIS</p>
                    </div>
                    <div class="about2">
                        Der bunte Medienmix ist die Faszination die uns antreibt und das, was man an uns schätzt. Von A bis Z und von vorne bis hinten nehmen wir Ihr Projekt unter unsere Fittiche und lassen es zu etwas Großartigem heranwachsen.
                    </div>
                    <div class="about3">
                        <div class="about3Item">
                            <img src="./img/about2.jpg" alt="">
                            <ul class="maskList">
                                <li class="maskItem">
                                    <img src="./img/about1.jpg" alt="">
                                </li>
                                <li class="maskItem">
                                    <img src="./img/about1.jpg" alt="">
                                </li>
                                <li class="maskItem">
                                    <img src="./img/about1.jpg" alt="">
                                </li>
                                <li class="maskItem">
                                    <img src="./img/about1.jpg" alt="">
                                </li>
                            </ul>
                        </div>
                        <div class="about3Item">
                            <img src="./img/about4.jpg" alt="">
                            <ul class="maskList">
                                <li class="maskItem">
                                    <img src="./img/about3.jpg" alt="">
                                </li>
                                <li class="maskItem">
                                    <img src="./img/about3.jpg" alt="">
                                </li>
                                <li class="maskItem">
                                    <img src="./img/about3.jpg" alt="">
                                </li>
                                <li class="maskItem">
                                    <img src="./img/about3.jpg" alt="">
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </li>
            <!--第五屏-->
            <li class="contentItem">
                <div class="contentInner">
                    <div class="team1">
                        <p class="team1Tit">EINBLI</p>
                        <p class="team1Tit">ERKENNT</p>
                    </div>
                    <div class="team2">
                        <p class="team2Text">Das Kundenvertrauen in unsere Kompetenz ist die notwendige Basis einer erfolgreichen Zusammenarbeit, gleichzeitig aber auch das größte Lob, das man uns entgegenbringen kann.</p>
                        <p class="team2Text">Diese und viele weitere große und kleine Kunden vertrauen uns seit Jahren, was uns stolz macht, und dafür sagen wir an dieser Stelle einfach mal.</p>
                    </div>
                    <ul class="team3">
                        <li class="team3Item"></li>
                        <li class="team3Item"></li>
                        <li class="team3Item"></li>
                        <li class="team3Item"></li>
                    </ul>
                </div>
            </li>
        </ul>
        <!--侧边栏-->
        <ul class="menuList">
            <li class="menuItem active"></li>
            <li class="menuItem"></li>
            <li class="menuItem"></li>
            <li class="menuItem"></li>
            <li class="menuItem"></li>
        </ul>
    </article>
</div>

<script>
// window.addEventListener("DOMContentLoaded",function () {
window.onload = function () {
    var oWrap = document.querySelector(".wrap");
    var oArrow = document.querySelector("#header .arrow");
    var oHeader = document.querySelector("#header");
    var oNavItem = document.querySelectorAll("#header .navList .navItem");
    var oUp = document.querySelectorAll("#header .navList .up");
    var oContent = document.querySelector(".wrap .content");
    var oContentItem = document.querySelectorAll(".wrap .content .contentItem");
    var oContentList = document.querySelector(".wrap .content .contentList");
    var oHomeIcon = document.querySelectorAll(".homeNav .homeIcon");
    var oHomeItem = document.querySelectorAll(".homeList .homeItem");
    var oTeamItem = document.querySelectorAll(".wrap .content .contentList .contentItem:nth-child(5) .contentInner .team3 .team3Item");
    var oTeam3 = document.querySelector(".wrap .content .contentList .contentItem:nth-child(5) .contentInner .team3");
    var oMusic = document.querySelector(".wrap .music");
    var oAudio = document.querySelector(".wrap .music audio");
    var oMaskLine = document.querySelector(".maskLine");
    var oMaskDown = document.querySelector(".maskDown");
    var oMaskUp = document.querySelector(".maskUp");
    var oMask = document.querySelector(".mask");
    var oMenuItem = document.querySelectorAll(".wrap .content .menuList .menuItem");
    var isAnimation = false;//保存图片是否正在走动
    var index = 0;//当前的屏幕是第一页
    var oldIndex = 0;
    var timer1 = null;
    var autoPlayTimer = null;
    var oMyCanvas = null;
    var createArcTimer = null;
    var drawArcTimer = null;
    // 初始化箭头位置，和up的高亮
    oArrow.style.left = oNavItem[2].getBoundingClientRect().left - oHeader.getBoundingClientRect().left + oArrow.offsetWidth/2 +(oNavItem[0].offsetWidth/2-oArrow.offsetWidth/2) + "px";
    oUp[2].style.width = "100%";

    contentMove(index);
    // 响应缩放
    window.onresize = function(){
        contentBind();
        contentMove(index);
    }
    // 点击nav  箭头和高亮的交互
    headerBind();
    function headerBind() {
        for (var i = 0; i < oNavItem.length; i++) {
            oNavItem[i].index = i;
            oNavItem[i].onclick = function () {
                animationArr[this.index].inAnimation();
                animationArr[index].outAnimation();
                index = this.index;
                contentMove(index);
            }
        }
    }

    // 屏幕切换逻辑封装
    function contentMove(index){
        for (var j = 0; j < oNavItem.length; j++) {
            oUp[j].style.width = "0";
        }

        // 清除侧边栏样式  然后再添加
        for (var j = 0; j < oMenuItem.length; j++) {
            oMenuItem[j].className = "menuItem";
        }
        oMenuItem[index].className = "menuItem active";
        // 给当前点击的加上高亮
        oUp[index].style.width = "100%";
        // 给箭头写位置
        oArrow.style.left = oNavItem[index].getBoundingClientRect().left - oHeader.getBoundingClientRect().left + oArrow.offsetWidth/2+(oNavItem[index].offsetWidth/2-oArrow.offsetWidth/2) + "px";
        //让内容区域走动
        oContentList.style.top = -(document.documentElement.clientHeight - oHeader.offsetHeight)*index +"px"
    }

    // 内容区的高度设置
    contentBind()
    function contentBind(){
        // 设置整个content的高度，是视口的高度减去头部的高度
        oContent.style.height = document.documentElement.clientHeight - oHeader.offsetHeight +"px";
        // 设置每一屏幕的高度
        for (var i = 0; i < oContentItem.length; i++) {
            oContentItem[i].style.height =document.documentElement.clientHeight - oHeader.offsetHeight +"px"
        }
    }

    // 鼠标滚轮模式
    document.onmousewheel = function (ev) {
        clearTimeout(timer1);
        timer1 = setTimeout(function () {
            scrollMove(ev)
        },200)
    };
    document.addEventListener("DOMMouseScroll",function () {
        clearTimeout(timer1);
        timer1 = setTimeout(function () {
            scrollMove(ev)
        },200)
    });
    function scrollMove(ev) {
        var flag = "";
        // ie/chrome
        if(ev.wheelDelta){
            if (ev.wheelDelta > 0){
                flag = "up";
            } else {
                flag = "down";
            }
        }
        //firfox
        if (ev.detail){
            if (ev.detail > 0){
                flag = "down";
            }else{
                flag = "up";
            }
        }

        // 判断上滚还是 下滚
        switch(flag){
            case "down":
                if (index < oContentItem.length - 1) {
                    animationArr[index].outAnimation();
                    index ++;
                    animationArr[index].inAnimation();
                    contentMove(index)
                }
                break;
            case "up":
                if (index > 0){
                    animationArr[index].outAnimation();
                    index --;
                    animationArr[index].inAnimation();
                    contentMove(index)
                }
                break;
        }
    }


    // 第一屏图片切换事件
    for (var i = 0; i < oHomeIcon.length; i++) {
        oHomeIcon[i].index = i;
        oHomeIcon[i].onclick = function () {
            if (isAnimation){
                return;
            }
            isAnimation = true;
            setTimeout(function () {
                isAnimation = false;
            },2000)
            for (var j = 0; j < oHomeIcon.length; j++) {
                oHomeIcon[j].className = "homeIcon";
            }
            this.className = "homeIcon active";
            if (this.index > oldIndex){
                oHomeItem[oldIndex].className ="homeItem leftHide";
                oHomeItem[this.index].className ="homeItem rightShow";
            } else if(this.index < oldIndex){
                oHomeItem[oldIndex].className ="homeItem rightHide ";
                oHomeItem[this.index].className ="homeItem leftShow";
            }

            oldIndex = this.index;
        }
    }

    // 第一屏自动轮播
    autoPlayTimer = setInterval(function () {
        if (isAnimation){
            return;
        }
        isAnimation = true;
        setTimeout(function () {
            isAnimation = false;
        },2000)

        //去掉小圆点样式
        for (var i = 0; i < oHomeIcon.length; i++) {
            oHomeIcon[i].className = "homeIcon"
        }

        // oldIndex就代表当前是哪一张图
        if (oldIndex < oHomeItem.length-1) {
            oldIndex++;
        }else{
            oldIndex = 0;
        }

        oHomeIcon[oldIndex].className = "homeIcon active";
        oHomeItem[oldIndex==0 ? 3 : oldIndex-1].className = "homeItem leftHide";
        oHomeItem[oldIndex].className = "homeItem rightShow";

    },3000)


    //第五屏 鼠标悬浮
    oTeam3.onmouseleave=function () {
        for (var j = 0; j < oTeamItem.length; j++) {
            oTeamItem[j].style.opacity = "0.5";
        }
        this.removeChild(oMyCanvas);
        oMyCanvas = null;
        clearInterval(drawArcTimer)
        clearInterval(createArcTimer)
    }
    for (var i = 0; i < oTeamItem.length; i++) {
        oTeamItem[i].onmouseenter = function () {
            for (var j = 0; j < oTeamItem.length; j++) {
                oTeamItem[j].style.opacity = "0.5";
            }
            this.style.opacity = 1;
            // 只创建一个canvas就可以了
            if (!oMyCanvas) {
                oMyCanvas = document.createElement("canvas");
                oMyCanvas.width = this.offsetWidth;
                oMyCanvas.height = this.offsetHeight;
                oTeam3.appendChild(oMyCanvas);
                addAnimation();
            }
            oMyCanvas.style.left = this.offsetLeft + "px";
        }
    }

    function addAnimation(){
        var ctx = oMyCanvas.getContext("2d");
        var arr = [];//容纳圆的容器
        // 每隔一段时间 就会画一个随机颜色随机位置 相同大小的 圆
        createArcTimer = setInterval(function () {
            var obj = {};
            obj.r = 10;//半径
            obj.x = Math.floor(Math.random()*oMyCanvas.width);
            obj.y = Math.floor(Math.random()*oMyCanvas.height);
            obj.red = Math.floor(Math.random()*255);
            obj.green = Math.floor(Math.random()*255);
            obj.blue = Math.floor(Math.random()*255);
            obj.op = Math.random();

            obj.deg = 0;
            obj.startX = obj.x;//起始的曲线x坐标
            obj.startY = oMyCanvas.height;//起始的曲线x坐标
            obj.pathScale = Math.floor(Math.random()*80 + 20);
            arr.push(obj);
        },20)

        drawArcTimer = setInterval(function () {
            ctx.clearRect(0,0,oMyCanvas.width,oMyCanvas.height);
            for (var i = 0; i < arr.length; i++) {
                arr[i].deg ++;
                arr[i].x = arr[i].startX + Math.sin(arr[i].deg * Math.PI / 180)*arr[i].pathScale*0.5;
                arr[i].y = arr[i].startY - (arr[i].deg * Math.PI / 180) * arr[i].pathScale*2;
                if (arr[i].y+arr[i].r<0){
                    arr.splice(i,1)
                }
            }

            for (var j = 0; j < arr.length; j++) {
                ctx.beginPath();
                ctx.arc(arr[j].x,arr[j].y,arr[j].r,0,2*Math.PI,true);
                ctx.fillStyle = `rgba(${arr[j].red},${arr[j].green},${arr[j].blue},${arr[j].op})`;
                ctx.fill();
            }

        },20)
    }

    //侧边栏
    for (var i = 0; i < oMenuItem.length; i++) {
        oMenuItem[i].index = i;
        oMenuItem[i].onclick = function () {
            for (var j = 0; j < oMenuItem.length; j++) {
                oMenuItem[j].className = "menuItem";
            }
            animationArr[index].outAnimation();
            animationArr[this.index].inAnimation();
            this.className = "menuItem active";
            contentMove(this.index);
            index = this.index;
        }
    }

    // 播放音乐
    oMusic.onclick = function () {
        if (oAudio.paused){
            oAudio.play();
            oMusic.style.backgroundImage = "url(./img/musicon.gif)";
        }else{
            oAudio.pause();
            oMusic.style.backgroundImage = "url(./img/musicoff.gif)";
        }
    }

    // 出入场动画的容器
    var animationArr = [
        {
            inAnimation:function () {
                var oHomeList = document.querySelector(".homeList");
                var oHomeNav = document.querySelector(".homeNav");
                oHomeList.style.opacity = "1";
                oHomeNav.style.opacity = "1";
                oHomeList.style.transform = "translateY(0)";
                oHomeNav.style.transform = "translateY(0)";
            },
            outAnimation:function () {
                var oHomeList = document.querySelector(".homeList");
                var oHomeNav = document.querySelector(".homeNav");
                oHomeList.style.opacity = "0.5";
                oHomeNav.style.opacity = "0.5";
                oHomeList.style.transform = "translateY(-200px)";
                oHomeNav.style.transform = "translateY(200px)";

            }
        },
        {
            inAnimation:function () {
                var oPlane1 = document.querySelector(".plane1");
                var oPlane2 = document.querySelector(".plane2");
                var oPlane3 = document.querySelector(".plane3");
                oPlane1.style.transform = "translate(0,0)";
                oPlane2.style.transform = "translate(0,0)";
                oPlane3.style.transform = "translate(0,0)";
            },
            outAnimation:function () {
                var oPlane1 = document.querySelector(".plane1");
                var oPlane2 = document.querySelector(".plane2");
                var oPlane3 = document.querySelector(".plane3");
                oPlane1.style.transform = "translate(-200px,-200px)";
                oPlane2.style.transform = "translate(-200px,200px)";
                oPlane3.style.transform = "translate(200px,-200px)";
            }
        },
        {
            inAnimation:function () {
                var oPancel1 = document.querySelector(".pancel1");
                var oPancel2 = document.querySelector(".pancel2");
                var oPancel3 = document.querySelector(".pancel3");
                oPancel1.style.transform = "translate(0,0)";
                oPancel2.style.transform = "translate(0,0)";
                oPancel3.style.transform = "translate(0,0)";
            },
            outAnimation:function () {
                var oPancel1 = document.querySelector(".pancel1");
                var oPancel2 = document.querySelector(".pancel2");
                var oPancel3 = document.querySelector(".pancel3");
                oPancel1.style.transform = "translate(0,-40px)";
                oPancel2.style.transform = "translate(0,200px)";
                oPancel3.style.transform = "translate(200px,200px)";
            }
        },
        {
            inAnimation:function () {
                var oAbout3Item1 = document.querySelector(".about3Item:nth-child(1)");
                var oAbout3Item2 = document.querySelector(".about3Item:nth-child(2)");
                oAbout3Item1.style.transform = "rotate(0deg)";
                oAbout3Item2.style.transform = "rotate(0deg)";
            },
            outAnimation:function () {
                var oAbout3Item1 = document.querySelector(".about3Item:nth-child(1)");
                var oAbout3Item2 = document.querySelector(".about3Item:nth-child(2)");
                oAbout3Item1.style.transform = "rotate(-30deg)";
                oAbout3Item2.style.transform = "rotate(30deg)";
            }
        },
        {
            inAnimation:function () {
                var oTeam1 = document.querySelector(".team1");
                var oTeam2 = document.querySelector(".team2");
                oTeam1.style.transform = "translateX(0)"
                oTeam2.style.transform = "translateX(0)"
            },
            outAnimation:function () {
                var oTeam1 = document.querySelector(".team1");
                var oTeam2 = document.querySelector(".team2");
                oTeam1.style.transform = "translateX(-200px)"
                oTeam2.style.transform = "translateX(200px)"
            }
        },
    ]

    // 临时调用出入场动画
    for (var i = 0; i < animationArr.length; i++) {
        animationArr[i].outAnimation();
    }
    setTimeout(function () {
        animationArr[0].inAnimation();
    },2000)

    // 开机动画
    var allImageArr = ['bg1.jpg','bg2.jpg','bg3.jpg','bg4.jpg','bg5.jpg','about1.jpg','about2.jpg','about3.jpg','about4.jpg','worksimg1.jpg','worksimg2.jpg','worksimg3.jpg','worksimg4.jpg','team.png'];
    var loaded = 0;//保存当前加载的图片数量
    for (var i = 0; i < allImageArr.length; i++) {
        var newImg = new Image();
        newImg.src = "./img/"+allImageArr[i];
        newImg.onload = function () {
            loaded ++;
            var scale = (loaded/allImageArr.length)*100;
            oMaskLine.style.width=scale+"%";
            /*if (scale>=100) {

            }*/
        }
        oMaskLine.addEventListener("transitionend",function () {
            oMaskDown.style.height = 0;
            oMaskUp.style.height = 0;
            oMask.removeChild(oMaskLine);
        })
        //
        oMaskDown.addEventListener("transitionend",function () {
            oWrap.removeChild(oMask);
        })
    }
}








    // ['bg1.jpg','bg2.jpg','bg3.jpg','bg4.jpg','bg5.jpg','about1.jpg','about2.jpg','about3.jpg','about4.jpg','worksimg1.jpg','worksimg2.jpg','worksimg3.jpg','worksimg4.jpg','team.png','greenLine.png']
// })
</script>
</body>
</html>